name: Publish MonoRepo Packages

on:
  push:
    tags:
      - 'Extensions-v*.*.*'
      - 'Singleton-v*.*.*'
      # 필요시 더 추가

jobs:
  publish-upm:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - name: Extensions
            folder: "."
            pattern: 'refs/tags/Extensions-'
          - name: Singleton
            folder: "."
            pattern: 'refs/tags/Singleton-'
    steps:
      - uses: actions/checkout@v2
        with:
          ref: ${{ github.ref }}
          fetch-depth: 1

      - uses: actions/setup-node@v2
        with:
          node-version: '18.x'

      - run: npm install -g openupm-cli

      - name: Publish ${{ matrix.name }}
        if: startsWith(github.ref, matrix.pattern)
        env:
          OPENUPM_TOKEN: ${{ secrets.OPENUPM_TOKEN }}
        run: |
          if [ "${{ matrix.folder }}" = "." ]; then
            openupm publish --access public
          else
            (cd ${{ matrix.folder }} && openupm publish --access public)
          fi
